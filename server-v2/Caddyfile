# Development - HTTP only
:8080 {
    # API Proxy - Main API
    handle /api/* {
        uri strip_prefix /api
        reverse_proxy bader-api:8000
    }
    
    # Admin API Proxy - S端per Admin API
    handle /admin/api/* {
        uri strip_prefix /admin/api
        reverse_proxy bader-admin-api:8001
    }
    
    # S端per Admin API (alternative path)
    handle /sadmin/* {
        uri strip_prefix /sadmin
        reverse_proxy bader-admin-api:8001
    }
    
    # Uploads
    handle /uploads/* {
        root * /srv
        file_server
    }
    
    # S端per Admin Panel
    handle /superadmin/* {
        uri strip_prefix /superadmin
        root * /srv/admin
        try_files {path} {path}/ /index.html
        file_server
    }
    
    # S端per Admin Panel root redirect
    handle /superadmin {
        redir /superadmin/ permanent
    }
    
    # Legacy Admin Panel
    handle /admin/* {
        uri strip_prefix /admin
        root * /srv/web/admin
        try_files {path} {path}/ /index.html
        file_server
    }
    
    # Admin Panel root redirect
    handle /admin {
        redir /admin/ permanent
    }
    
    # Web App (Belge Onay vs)
    handle {
        root * /srv/web/public
        try_files {path} {path}/ /index.html
        file_server
    }
    
    encode gzip
    
    # CORS headers
    header {
        Access-Control-Allow-Origin *
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization, X-Admin-Key, X-API-Key, X-Customer-ID"
    }
}

# Production with SSL - uncomment and configure domain
# {$DOMAIN} {
#     handle /api/* {
#         uri strip_prefix /api
#         reverse_proxy api:8000
#     }
#     
#     handle /uploads/* {
#         root * /srv
#         file_server
#     }
#     
#     handle /admin* {
#         root * /srv/web/admin
#         try_files {path} {path}/ /admin/index.html
#         file_server
#     }
#     
#     handle {
#         root * /srv/web/public
#         try_files {path} {path}/ /index.html
#         file_server
#     }
#     
#     encode gzip
# }

# BADER Sistem Mimarisi

## ğŸ—ï¸ Genel BakÄ±ÅŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BADER EKOSÄ°STEMÄ°                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  WEB APP     â”‚    â”‚  MASAÃœSTÃœ    â”‚    â”‚  MOBÄ°L APP   â”‚              â”‚
â”‚  â”‚  (Vue 3)     â”‚    â”‚  (PyQt5)     â”‚    â”‚  (Gelecek)   â”‚              â”‚
â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚              â”‚
â”‚  â”‚ - Online     â”‚    â”‚ - Offline OK â”‚    â”‚ - Hybrid     â”‚              â”‚
â”‚  â”‚ - TarayÄ±cÄ±   â”‚    â”‚ - SQLite     â”‚    â”‚              â”‚              â”‚
â”‚  â”‚ - Responsive â”‚    â”‚ - Sync       â”‚    â”‚              â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                   â”‚                                           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                   â”‚                                                     â”‚
â”‚                   â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      SUNUCU (157.90.154.48)                      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚   CADDY     â”‚  â”‚  FastAPI    â”‚  â”‚ PostgreSQL  â”‚              â”‚   â”‚
â”‚  â”‚  â”‚  (Reverse   â”‚â”€â”€â”‚  (API)      â”‚â”€â”€â”‚ (Database)  â”‚              â”‚   â”‚
â”‚  â”‚  â”‚   Proxy)    â”‚  â”‚             â”‚  â”‚             â”‚              â”‚   â”‚
â”‚  â”‚  â”‚  :8080      â”‚  â”‚  :8000      â”‚  â”‚  :5432      â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚         â”‚                                                         â”‚   â”‚
â”‚  â”‚         â–¼                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚                    STATIC FILES                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  /web     â†’ Vue SPA (index.html, assets)                â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  /uploads â†’ DMG, gÃ¼ncellemeler, belgeler                â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  /admin   â†’ Admin panel                                  â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“± KullanÄ±m SenaryolarÄ±

### 1. Web KullanÄ±cÄ±sÄ± (Online)
- TarayÄ±cÄ±dan `http://157.90.154.48:8080` adresine girer
- Lisans ID + kullanÄ±cÄ± adÄ±/ÅŸifre ile giriÅŸ yapar
- TÃ¼m veriler sunucuda tutulur
- Her iÅŸlem anlÄ±k kaydedilir

### 2. MasaÃ¼stÃ¼ KullanÄ±cÄ±sÄ± (Hybrid)
- Uygulama aÃ§Ä±lÄ±ÅŸta sunucuya baÄŸlanmaya Ã§alÄ±ÅŸÄ±r
- **Online mod:** Veriler sunucu ile senkronize
- **Offline mod:** Lokal SQLite kullanÄ±r, internet gelince sync

### 3. Lisanslama AkÄ±ÅŸÄ±
```
1. MÃ¼ÅŸteri lisans satÄ±n alÄ±r
2. Admin panel'den mÃ¼ÅŸteri oluÅŸturulur â†’ Lisans ID + API Key Ã¼retilir
3. MÃ¼ÅŸteriye Lisans ID verilir
4. MasaÃ¼stÃ¼/Web'de bu ID ile aktivasyon yapÄ±lÄ±r
5. Sunucu aktivasyonu doÄŸrular ve kullanÄ±cÄ± oluÅŸturur
```

### 4. GÃ¼ncelleme AkÄ±ÅŸÄ±
```
1. Yeni versiyon build edilir (PyInstaller)
2. DMG/EXE sunucuya yÃ¼klenir
3. Admin panelden versiyon aktif edilir
4. Uygulama aÃ§Ä±lÄ±ÅŸta /version/check endpoint'ini kontrol eder
5. GÃ¼ncelleme varsa kullanÄ±cÄ±ya bildirilir
6. Ä°ndirme linki verilir
```

## ğŸ—„ï¸ VeritabanÄ± ÅemasÄ±

### Multi-Tenant YapÄ±
- Her mÃ¼ÅŸterinin `customer_id` si var
- TÃ¼m tablolarda `customer_id` foreign key
- Bir mÃ¼ÅŸteri sadece kendi verilerini gÃ¶rÃ¼r

### Ana Tablolar
| Tablo | AÃ§Ä±klama |
|-------|----------|
| customers | LisanslÄ± mÃ¼ÅŸteriler (dernekler) |
| users | KullanÄ±cÄ±lar (her mÃ¼ÅŸterinin altÄ±nda) |
| members | Dernek Ã¼yeleri |
| incomes | Gelir kayÄ±tlarÄ± |
| expenses | Gider kayÄ±tlarÄ± |
| dues | Aidat takibi |
| cash_accounts | Kasa hesaplarÄ± |
| transfers | Virman iÅŸlemleri |
| events | Etkinlikler |
| meetings | ToplantÄ±lar |
| documents | Belgeler |
| settings | Ayarlar |
| app_versions | Uygulama versiyonlarÄ± |
| activation_logs | Aktivasyon loglarÄ± |
| dynamic_menus | Dinamik menÃ¼ler |

## ğŸ” GÃ¼venlik

### Kimlik DoÄŸrulama
- JWT token based auth
- Token 24 saat geÃ§erli
- Refresh token ile yenileme

### Yetkilendirme
- Role-based: admin, manager, member
- Permission-based: read, write, delete per module

### API GÃ¼venliÄŸi
- CORS ayarlarÄ±
- Rate limiting (gelecek)
- API key validation

## ğŸ“ Dosya YapÄ±sÄ±

```
sunucu/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Caddyfile
â”œâ”€â”€ api/
â”‚   â””â”€â”€ main.py              # FastAPI backend
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ index.html           # Vue SPA entry
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ app.js           # Vue application
â”‚   â”‚   â””â”€â”€ style.css        # Tailwind CSS
â”‚   â””â”€â”€ favicon.ico
â””â”€â”€ uploads/
    â”œâ”€â”€ updates/             # DMG/EXE dosyalarÄ±
    â””â”€â”€ documents/           # KullanÄ±cÄ± belgeleri

masaÃ¼stÃ¼/
â”œâ”€â”€ main_fluent_full.py      # Ana uygulama
â”œâ”€â”€ database.py              # SQLite + Sync
â”œâ”€â”€ server_client.py         # API iletiÅŸimi
â”œâ”€â”€ ui_*.py                  # UI modÃ¼lleri
â””â”€â”€ ...
```

## ğŸš€ URL YapÄ±sÄ±

| URL | AÃ§Ä±klama |
|-----|----------|
| http://157.90.154.48:8080/ | Web uygulamasÄ± |
| http://157.90.154.48:8080/api/* | API endpoints |
| http://157.90.154.48:8080/admin | Admin panel |
| http://157.90.154.48:8080/uploads/* | Static dosyalar |

## ğŸ”„ Sync MekanizmasÄ± (MasaÃ¼stÃ¼)

```python
# Offline â†’ Online geÃ§iÅŸ
1. Son sync timestamp kontrol
2. Lokal deÄŸiÅŸiklikleri topla (created_at > last_sync)
3. Sunucuya POST /sync/upload
4. Sunucudan deÄŸiÅŸiklikleri al GET /sync/download?since=timestamp
5. Lokal veritabanÄ±nÄ± gÃ¼ncelle
6. Ã‡akÄ±ÅŸma varsa â†’ en son deÄŸiÅŸen kazanÄ±r
```
